<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pirate Adventure</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { width: 100vw; height: 100vh; overflow: hidden; }

    .scene {
      position: fixed;
      inset: 0;
      display: none;
    }
    .scene.active { display: block; }

    /* ════════════════════════════
       SCENE 1 – Ship & Island
    ════════════════════════════ */
    #scene1 {
      background: url('png/background.png') center / cover no-repeat;
    }

    /* Ship: center at 30% from left edge, vertically centered, 20% of screen */
    #ship {
      position: absolute;
      width: 20vw;
      height: 20vh;
      object-fit: contain;
      left: calc(30% - 10vw);
      top: 50%;
      transform: translateY(-50%);
      cursor: grab;
      user-select: none;
      z-index: 10;
      transition: opacity 0.4s;
      animation: shipHint 2.4s ease-in-out infinite;
    }

    /* Affordance: ship nudges toward the island then returns */
    @keyframes shipHint {
      0%   { transform: translateY(-50%) translateX(0);     }
      35%  { transform: translateY(-50%) translateX(22vw);  }
      55%  { transform: translateY(-50%) translateX(22vw);  }
      90%  { transform: translateY(-50%) translateX(0);     }
      100% { transform: translateY(-50%) translateX(0);     }
    }

    /* Island: center at 30% from right edge (70% from left), vertically centered */
    #island {
      position: absolute;
      width: 20vw;
      height: 20vh;
      object-fit: contain;
      left: calc(70% - 10vw);
      top: 50%;
      transform: translateY(-50%);
      transition: opacity 0.4s;
    }

    /* ════════════════════════════
       SCENE 2 – Pirate Battle
    ════════════════════════════ */
    #scene2 { overflow: hidden; }

    #bg-img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    #pirate-wrap {
      position: absolute;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);
      width: 35vw;
      height: 80vh;
      z-index: 1;
    }

    #pirate-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: bottom;
    }

    #attack-btn {
      position: absolute;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #ff6666, #bb0000);
      border: 4px solid rgba(255, 160, 160, 0.85);
      cursor: pointer;
      top: 28%;
      left: 50%;
      transform: translateX(-50%);
      animation: aPulse 0.9s ease-in-out infinite;
      z-index: 20;
      box-shadow: 0 0 22px rgba(255, 0, 0, 0.55), inset 0 2px 5px rgba(255,255,255,0.25);
    }

    #attack-btn::before {
      content: '';
      position: absolute;
      inset: 9px;
      border-radius: 50%;
      border: 2px solid rgba(255, 210, 210, 0.5);
    }

    #attack-btn::after {
      content: '✕';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255, 255, 255, 0.9);
      font-size: 22px;
      font-weight: bold;
      pointer-events: none;
    }

    @keyframes aPulse {
      0%, 100% {
        transform: translateX(-50%) scale(1);
        box-shadow: 0 0 22px rgba(255,0,0,0.55);
      }
      50% {
        transform: translateX(-50%) scale(1.18);
        box-shadow: 0 0 38px rgba(255,0,0,0.9);
      }
    }

    /* ════════════════════════════
       SCENE 3 – Map
    ════════════════════════════ */
    #scene3 {
      background: radial-gradient(ellipse at center, #1a1a2e 0%, #080810 100%);
      display: none;
      align-items: center;
      justify-content: center;
    }
    #scene3.active { display: flex; }

    #map-wrap {
      position: relative;
      width: 70vw;
      height: 70vh;
      animation: mapPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes mapPop {
      0%   { transform: scale(0) rotate(-6deg); opacity: 0; }
      100% { transform: scale(1) rotate(0deg);  opacity: 1; }
    }

    #map-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 6px;
    }

    #star-img {
      position: absolute;
      width: 50px;
      height: 50px;
      cursor: pointer;
      transform-origin: center;
      animation: sparkle 0.75s ease-in-out infinite;
      filter: drop-shadow(0 0 8px gold) drop-shadow(0 0 3px orange);
    }

    /* Star scales between 100% and 150% */
    @keyframes sparkle {
      0%, 100% { transform: scale(1);   }
      50%       { transform: scale(1.5); }
    }

    /* ════════════════════════════
       SCENE 4 – Treasure Chest
    ════════════════════════════ */
    #scene4 {
      background: radial-gradient(ellipse at center bottom, #3d1f00 0%, #150800 100%);
    }

    /* 50% of screen width × 50% of screen height; horizontally centered; animates from top */
    #chest-img {
      position: absolute;
      width: 50vw;
      height: 50vh;
      object-fit: contain;
      left: 50%;
      transform: translateX(-50%);
      cursor: pointer;
      top: -60%;   /* starts above screen */
    }
  </style>
</head>
<body>

  <!-- ════ SCENE 1: Ship & Island ════ -->
  <div id="scene1" class="scene active">
    <img id="ship"   src="png/ship.png"   alt="Ship"   draggable="false" />
    <img id="island" src="png/island.png" alt="Island" />
  </div>

  <!-- ════ SCENE 2: Pirate Battle ════ -->
  <div id="scene2" class="scene">
    <img id="bg-img" src="png/background.png" alt="Background" />
    <div id="pirate-wrap">
      <img id="pirate-img" src="png/pirate.png" alt="Pirate" />
      <div id="attack-btn" role="button" aria-label="Attack"></div>
    </div>
  </div>

  <!-- ════ SCENE 3: Map ════ -->
  <div id="scene3" class="scene">
    <div id="map-wrap">
      <img id="map-img"  src="png/map.png"  alt="Map" />
      <img id="star-img" src="png/star.png" alt="Star" />
    </div>
  </div>

  <!-- ════ SCENE 4: Treasure Chest ════ -->
  <div id="scene4" class="scene">
    <img id="chest-img" src="png/treasure_chest _close.png" alt="Treasure Chest" />
  </div>

  <!-- Audio assets -->
  <audio id="pirate-sick-sfx" src="png/pirate sick.m4a"  preload="auto"></audio>
  <audio id="pirate-voice"    src="png/pirate voice.m4a" preload="auto"></audio>
  <audio id="treasure-sfx"    src="png/treasure.mp3"     preload="auto"></audio>

<script>
// ─────────────────────────────────────────
//  Utilities
// ─────────────────────────────────────────
function showScene(id) {
  document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ─────────────────────────────────────────
//  SCENE 1 – Ship Drag to Island
// ─────────────────────────────────────────
const ship   = document.getElementById('ship');
const island = document.getElementById('island');
let dragging = false;
let dragOffX = 0, dragOffY = 0;

function dragStart(cx, cy) {
  dragging = true;
  const r = ship.getBoundingClientRect();
  dragOffX = cx - r.left;
  dragOffY = cy - r.top;
  // Stop the hint animation and lock to pixel coordinates
  ship.style.animation = 'none';
  ship.style.transform = 'none';
  ship.style.left      = r.left + 'px';
  ship.style.top       = r.top  + 'px';
  ship.style.cursor    = 'grabbing';
}

function dragMove(cx, cy) {
  if (!dragging) return;
  ship.style.left = (cx - dragOffX) + 'px';
  ship.style.top  = (cy - dragOffY) + 'px';
}

function dragEnd() {
  if (!dragging) return;
  dragging = false;
  ship.style.cursor = 'grab';

  const sr  = ship.getBoundingClientRect();
  const ir  = island.getBoundingClientRect();
  const hit = !(sr.right  < ir.left || sr.left > ir.right ||
                sr.bottom < ir.top  || sr.top  > ir.bottom);

  if (hit) {
    ship.style.opacity   = '0';
    island.style.opacity = '0';
    setTimeout(() => showScene('scene2'), 400);
  }
}

// Mouse events
ship.addEventListener('mousedown', e => { dragStart(e.clientX, e.clientY); e.preventDefault(); });
document.addEventListener('mousemove', e => dragMove(e.clientX, e.clientY));
document.addEventListener('mouseup',   () => dragEnd());

// Touch events
ship.addEventListener('touchstart', e => {
  dragStart(e.touches[0].clientX, e.touches[0].clientY);
  e.preventDefault();
}, { passive: false });
document.addEventListener('touchmove', e => {
  dragMove(e.touches[0].clientX, e.touches[0].clientY);
  e.preventDefault();
}, { passive: false });
document.addEventListener('touchend', () => dragEnd());

// ─────────────────────────────────────────
//  SCENE 2 – 3-Round Battle
//
//  Round flow:
//    User clicks circle → pirate hurt + sick sound (2 s)
//    → pirate returns to normal
//    → [rounds 1 & 2 only] 0.5 s pause → pirate attacks (2 s) + voice sound
//    → pirate returns to normal → show circle again
//    Round 3: no counterattack → pirate falls → Scene 3
// ─────────────────────────────────────────
const pirateImg     = document.getElementById('pirate-img');
const attackBtn     = document.getElementById('attack-btn');
const pirateSickSfx = document.getElementById('pirate-sick-sfx');
const pirateVoice   = document.getElementById('pirate-voice');
let round = 0;
let busy  = false;

attackBtn.addEventListener('click', () => {
  if (busy) return;
  busy = true;
  round++;
  attackBtn.style.display = 'none';

  // ── User attacks: pirate shows hurt image (random variant) + sick sound ──
  pirateImg.src = Math.random() < 0.5
    ? 'png/pirate_sick.png'
    : 'png/pirate_sick2.png';
  pirateSickSfx.currentTime = 0;
  pirateSickSfx.play().catch(() => {});

  setTimeout(() => {
    pirateImg.src = 'png/pirate.png';   // pirate returns to original

    if (round < 3) {
      // ── Pirate counterattacks (0.5 s after returning) ──
      setTimeout(() => {
        pirateImg.src = 'png/pirate_fight.png';
        // Play pirate voice at exact moment attack image appears
        pirateVoice.currentTime = 0;
        pirateVoice.play().catch(() => {});

        setTimeout(() => {
          pirateImg.src = 'png/pirate.png';   // pirate returns to original
          busy = false;
          attackBtn.style.display = '';        // show attack circle for next round
        }, 2000);

      }, 500);

    } else {
      // ── Round 3: no counterattack – pirate falls ──
      setTimeout(() => {
        pirateImg.src = 'png/pirate_down.png';
        setTimeout(() => enterScene3(), 2000);
      }, 500);
    }

  }, 2000);   // pirate stays hurt for 2 s
});

// ─────────────────────────────────────────
//  SCENE 3 – Map pop-out
// ─────────────────────────────────────────
function enterScene3() {
  showScene('scene3');

  // Re-trigger the pop animation
  const mw = document.getElementById('map-wrap');
  mw.style.animation = 'none';
  void mw.offsetHeight;   // force reflow
  mw.style.animation = '';

  // Place the star at a random position within the central 40% of the map
  // Central 40% means: x from 30%–70%, y from 30%–70%
  const star = document.getElementById('star-img');
  const x = 30 + Math.random() * 40;   // 30% to 70%
  const y = 30 + Math.random() * 40;   // 30% to 70%
  star.style.left = x + '%';
  star.style.top  = y + '%';
}

document.getElementById('star-img').addEventListener('click', () => {
  showScene('scene4');
  enterScene4();
});

// ─────────────────────────────────────────
//  SCENE 4 – Treasure Chest drop-in
// ─────────────────────────────────────────
const treasureSfx = document.getElementById('treasure-sfx');

function enterScene4() {
  const chest = document.getElementById('chest-img');
  chest.src = 'png/treasure_chest _close.png';

  // Reset to above screen with no transition
  chest.style.transition = 'none';
  chest.style.top        = '-60%';

  // Two rAFs ensure the browser registers the start position before animating
  requestAnimationFrame(() => requestAnimationFrame(() => {
    chest.style.transition = 'top 0.85s cubic-bezier(0.34, 1.56, 0.64, 1)';
    // Chest center at 40% from top = 60% from bottom
    // Chest height = 50vh → top edge at 40% - 25vh
    chest.style.top = 'calc(40% - 25vh)';
  }));
}

document.getElementById('chest-img').addEventListener('click', () => {
  const chest = document.getElementById('chest-img');
  if (!chest.src.includes('open')) {
    chest.src = 'png/treasure_chest_open.png';
    treasureSfx.currentTime = 0;
    treasureSfx.play().catch(() => {});
  }
});
</script>
</body>
</html>
